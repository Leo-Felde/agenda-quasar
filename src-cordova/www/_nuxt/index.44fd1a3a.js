import{_ as U,r as v,I as D,o as F,k as x,l as N,q as l,s as i,v as q,J as K,H as B,z as W,c as T,A as h,C as S,m as y,F as G,K as X,L as Y,M as Z,t as g,N as $,G as oo,x as eo,y as ao}from'./entry.262740d5.js';import{_ as O,i as to,c as R,s as no,a as H,b as lo,d as so}from'./promptDialog.55ad8c7a.js';import{m as ro,_ as io,a as co,b as uo,c as mo}from'./DialogoPessoa.d9bc7f38.js';import{_ as M,a as L,b as _o}from'./ClosePopup.8a3daebd.js';import{_ as fo,a as vo}from'./DialogoCrud.b0f606bf.js';import{s as C,r as po,c as J,a as I,_ as Vo}from'./index.a988fc85.js';import{_ as yo}from'./DialogoUsuario.dc9c2d83.js';import{m as wo}from'./usuarios.bd8c83a0.js';import'./QList.c13a3d38.js';const xo={props:{modelValue:{type:Object,default:()=>{}},showAddBtn:Boolean},emits:['update:modelValue'],setup(a,{emit:e}){const u=v(!1),o=v([]),f=v(null);D(()=>a.modelValue,()=>{var r;(r=a.modelValue)!=null&&r.id?o.value.some(d=>d.id===a.modelValue.id)||(o.value.push(a.modelValue),setTimeout(()=>{f.value=a.modelValue},100)):c('')}),F(()=>{a.modelValue&&o.value.push(a.modelValue)});const c=async r=>{try{const d={nome:r},m=await ro.pesquisar(d);o.value=m.data}catch(d){console.error(d),C('Não foi possivel pesquisar pessoas')}},s=()=>{e('update:modelValue',f.value)};return{showDialogCrud:u,pessoas:o,buscarPessoas:c,selecionarPessoa:s,pessoaSelecionada:f,adicionarNovaPessoa:r=>{o.value.push(r.object),setTimeout(()=>{f.value=r.object},100),setTimeout(()=>{s()},200),s()}}}};function bo(a,e,u,o,f,c){const s=M,p=L,r=B,d=O,m=io;return x(),N('div',null,[l(d,{modelValue:o.pessoaSelecionada,'onUpdate:modelValue':[e[1]||(e[1]=n=>o.pessoaSelecionada=n),o.selecionarPessoa],label:'pessoa','option-label':'nome','use-input':'',filled:'',options:o.pessoas,error:!1,onInputValue:o.buscarPessoas},{'no-option':i(()=>[l(p,null,{default:i(()=>[l(s,{class:'text-grey'},{default:i(()=>[q(' Nenhuma pessoa encontrada ')]),_:1})]),_:1})]),append:i(()=>[l(r,{class:'q-ml-sm add-btn',icon:'add',color:'primary',round:'',dense:'',onClick:e[0]||(e[0]=K(n=>o.showDialogCrud=!0,['stop','prevent']))})]),_:1},8,['modelValue','options','onInputValue','onUpdate:modelValue']),l(m,{modelValue:o.showDialogCrud,'onUpdate:modelValue':e[2]||(e[2]=n=>o.showDialogCrud=n),onAtualizar:o.adicionarNovaPessoa},null,8,['modelValue','onAtualizar'])])}const Co=U(xo,[['render',bo]]),go={props:{modelValue:{type:Object,default:()=>{}}},emits:['update:modelValue'],setup(a,{emit:e}){const u=v(!1),o=v([]),f=v(null),c=W(),s=T(()=>c.value.tipos.includes('ROLE_ADMIN'));D(()=>a.modelValue,()=>{var m;(m=a.modelValue)!=null&&m.id?o.value.some(n=>n.id===a.modelValue.id)||(o.value.push(a.modelValue),setTimeout(()=>{f.value=a.modelValue},100)):p('')}),F(()=>{a.modelValue&&o.value.push(a.modelValue)});const p=async m=>{try{const n={termo:m},b=await wo.pesquisar(n);o.value=b.data}catch(n){console.error(n),C('Não foi possivel pesquisar usuários')}},r=()=>{e('update:modelValue',f.value)};return{showDialogCrud:u,usuarios:o,usuarioSelecionado:f,userAdmin:s,buscarUsuarios:p,selecionarUsuario:r,adicionarNovoUsuario:m=>{o.value.push(m.object),setTimeout(()=>{usuarioSelecionada.value=m.object},100),setTimeout(()=>{r()},200),r()}}}};function qo(a,e,u,o,f,c){const s=M,p=L,r=B,d=O,m=yo;return x(),N('div',null,[l(d,{modelValue:o.usuarioSelecionado,'onUpdate:modelValue':[e[1]||(e[1]=n=>o.usuarioSelecionado=n),o.selecionarUsuario],label:'usuario','option-label':'nome','use-input':'',filled:'',options:o.usuarios,error:!1,onInputValue:o.buscarUsuarios},{'no-option':i(()=>[l(p,null,{default:i(()=>[l(s,{class:'text-grey'},{default:i(()=>[q(' Nenhum usuario encontrado ')]),_:1})]),_:1})]),append:i(()=>[o.userAdmin?(x(),h(r,{key:0,class:'q-ml-sm add-btn',icon:'add',color:'primary',dense:'',round:'',onClick:e[0]||(e[0]=K(n=>o.showDialogCrud=!0,['stop','prevent']))})):S('',!0)]),_:1},8,['modelValue','options','onInputValue','onUpdate:modelValue']),l(m,{modelValue:o.showDialogCrud,'onUpdate:modelValue':e[2]||(e[2]=n=>o.showDialogCrud=n),onAtualizar:o.adicionarNovoUsuario},null,8,['modelValue','onAtualizar'])])}const ho=U(go,[['render',qo]]),Do={props:{contato:{type:Object,default:()=>({})},readonly:Boolean},setup(a){const e=v({}),u=v([{text:'E-mail',value:'EMAIL'},{text:'Celular',value:'CELULAR'},{text:'Telefone',value:'TELEFONE'}]);return D(()=>a.contato,()=>{e.value=a.contato}),F(()=>{e.value=a.contato}),{form:e,rules:po,tiposContato:u}}},No={class:'q-px-md'},Uo={class:'row q-col-gutter-md'},ko={class:'responsive-col-6'},Ao={class:'responsive-col-6'},Eo={class:'row q-col-gutter-md'},So={class:'responsive-col-4'},To={class:'responsive-col-4'},Io={class:'responsive-col-4'},Fo={class:'row q-col-gutter-md'},zo={class:'responsive-col-4'},Po={class:'responsive-col-4'};function jo(a,e,u,o,f,c){const s=Co,p=ho,r=O,d=G,m=X;return x(),N('div',No,[y('div',Uo,[y('div',ko,[l(s,{modelValue:o.form.pessoa,'onUpdate:modelValue':e[0]||(e[0]=n=>o.form.pessoa=n)},null,8,['modelValue'])]),y('div',Ao,[l(p,{modelValue:o.form.usuario,'onUpdate:modelValue':e[1]||(e[1]=n=>o.form.usuario=n)},null,8,['modelValue'])])]),y('div',Eo,[y('div',So,[l(r,{modelValue:o.form.tipoContato,'onUpdate:modelValue':e[2]||(e[2]=n=>o.form.tipoContato=n),filled:'',label:'Forma de contato *','option-label':'text','option-value':'value','map-options':'','emit-value':'',options:o.tiposContato,readonly:u.readonly,rules:[o.rules.obrigatorio]},null,8,['modelValue','options','readonly','rules'])]),y('div',To,[l(d,{modelValue:o.form.email,'onUpdate:modelValue':e[3]||(e[3]=n=>o.form.email=n),filled:'',label:'E-mail',rules:[o.rules.email],readonly:u.readonly},null,8,['modelValue','rules','readonly'])]),y('div',Io,[l(d,{modelValue:o.form.telefone,'onUpdate:modelValue':e[4]||(e[4]=n=>o.form.telefone=n),filled:'',label:'Telefone',readonly:u.readonly,error:!1},null,8,['modelValue','readonly'])])]),y('div',Fo,[y('div',zo,[l(d,{modelValue:o.form.tag,'onUpdate:modelValue':e[5]||(e[5]=n=>o.form.tag=n),filled:'',label:'Tag',readonly:u.readonly},null,8,['modelValue','readonly'])]),y('div',Po,[l(m,{modelValue:o.form.privado,'onUpdate:modelValue':e[6]||(e[6]=n=>o.form.privado=n),label:'Contato privado'},null,8,['modelValue'])])])])}const Bo=U(Do,[['render',jo]]),Oo='/contato',E=J(Oo),Q={listar(a){return E.get(`/listar/${a}`)},pesquisar(a){return E.post('/pesquisar',a)},excluir(a){return E.delete(`/remover/${a}`)},salvar(a){return E.post('/salvar',a)}},Mo={props:{contato:{type:Object,default:()=>({privado:!1})},modelValue:Boolean},emits:['update:modelValue','atualizar'],setup(a,{emit:e}){const u=v(!1),o=v(null),f=v(!1),c=v({}),s=v({}),p=T(()=>!to(c.value,s.value)),r=T(()=>a.contato.id?'Alterar contato':'Novo contato');D(()=>a.contato,()=>{a.contato.id&&b()}),D(()=>a.modelValue,V=>{f.value=V,V&&a.contato.id&&b()});const d=async()=>{p.value?await no()&&w():w()},m=async()=>{if(o.value.validate()){if(!p.value){w();return}try{const V=await Q.salvar(c.value);I(a.contato.id?'Contato atualizado':'Contato cadastrado'),e('atualizar',V.data),w()}catch(V){console.error(V),C('Não foi possível salvar as alterações')}finally{u.value=!1}}},n=async()=>{if(await H('Excluir contato','Deseja excluir esse contato? Isso não pode ser revertido'))try{I('Contato excluído com sucesso'),e('atualizar'),w()}catch{C('Não foi possível excluir o contato')}finally{u.value=!1}},b=()=>{try{s.value=a.contato,c.value=R(s.value)}catch(V){console.error(V),C('Não foi possível carregar o contato')}finally{u.value=!1}},w=()=>{s.value={privado:!1},c.value=R(s.value),o.value.resetValidation(),e('update:modelValue',!1)};return{formulario:o,showDialog:f,titulo:r,contatoSelecionado:c,contatoOriginal:s,cancelar:d,salvar:m,excluir:n}}};function Lo(a,e,u,o,f,c){const s=Bo,p=Vo,r=fo;return x(),h(r,{modelValue:o.showDialog,'onUpdate:modelValue':e[0]||(e[0]=d=>o.showDialog=d),title:o.titulo,'show-delete-btn':!!o.contatoSelecionado.id,onSalvar:o.salvar,onCancelar:o.cancelar,onExcluir:o.excluir},{default:i(()=>[l(p,{ref:'formulario'},{default:i(()=>[l(s,{class:'ma-3',contato:o.contatoSelecionado},null,8,['contato'])]),_:1},512)]),_:1},8,['modelValue','title','show-delete-btn','onSalvar','onCancelar','onExcluir'])}const Ro=U(Mo,[['render',Lo]]),Ko='/favorito',P=J(Ko),j={pesquisar(){return P.get('/pesquisar')},excluir(a){return P.delete(`/remover/${a}`)},salvar(a){return P.post('/salvar',a)}};const Go=[{name:'nome',field:'pessoa.nome',label:'Nome',align:'left',sortable:!0},{name:'tipoContato',field:'tipoContato',label:'Forma de contato',align:'center',sortable:!0},{name:'telefone',field:'telefone',label:'Telefone',sortable:!0},{name:'email',field:'email',label:'E-mail',sortable:!0},{name:'endereco',field:'pessoa.endereco',label:'Endereço',sortable:!0},{name:'actions',align:'center',label:'Ações'}],Ho=['favorite'],Jo={setup(){const a=v(''),e=v([]),u=v([]),o=v([]),f=v({}),c=v(!1),s=v(!1),p=Y(),r=T(()=>p.platform.is.mobile);F(()=>{V()});const d=_=>{f.value=_,s.value=!0},m=()=>{f.value={},s.value=!0},n=async()=>{if(await H('Excluir contato','Deseja excluir esse contato? Isso não pode ser revertido'))try{I('Contato excluído com sucesso'),w()}catch{C('Não foi possível excluir o contato')}finally{c.value=!1}},b=async()=>{c.value=!0;try{const _=await j.pesquisar();u.value=new Set(_.data.map(t=>t.id))}catch(_){console.error(_),C('Não foi possível listar os favoritos')}finally{c.value=!1}},w=async(_=!1)=>{c.value=!0;try{const t={termo:_&&a.value||''},A=await Q.pesquisar(t);e.value=A.data}catch(t){console.error(t),C('Não foi possível listar os contatos')}finally{c.value=!1}},V=async(_=!1)=>{await w(),_?(await w(!0),o.value=e.value):(await w(),await b(),o.value=e.value.map(t=>({...t,favorito:u.value.has(t.id)})))},k=async _=>{_.favorito&&!await lo('Desfavoritar','Remover este contato dos favoritos?')||z(_)},z=async _=>{try{_.favorito?await j.excluir(_.id):await j.salvar(_),I(`Contato ${_.favorito?'des':''}favoritado com sucesso`),V()}catch(t){console.error(t),C(`Não foi possível ${_.favorito?'des':''}favoritar o contato`)}};return{columns:Go,extraActions:Ho,search:a,showDialog:s,loading:c,lista:o,contatoSelecionado:f,isMobile:r,listarTodos:V,editarContato:d,novoContato:m,excluirContato:n,toggleFavorito:k}}},Qo=a=>(eo('data-v-d8c9b922'),a=a(),ao(),a),Wo=Qo(()=>y('span',{class:'text-h6 q-my-auto'},'Contatos',-1)),Xo={key:0};function Yo(a,e,u,o,f,c){const s=oo,p=G,r=so,d=B,m=co,n=uo,b=M,w=L,V=mo,k=vo,z=Ro,_=_o;return x(),N('div',null,[l(k,{class:'sticky-header',flat:'',bordered:'',rows:o.lista,columns:o.columns,loading:o.loading,'virtual-scroll':'','row-key':'field',onRowClick:e[4]||(e[4]=(t,A)=>o.editarContato(A))},{top:i(()=>[Wo,a.$q.screen.lt.md?S('',!0):(x(),h(p,{key:0,modelValue:o.search,'onUpdate:modelValue':e[1]||(e[1]=t=>o.search=t),class:'q-ml-sm',rounded:'',standout:'',dense:'',clearable:'',placeholder:'Pesquisar',onKeyup:e[2]||(e[2]=Z(t=>o.listarTodos(!0),['enter'])),onClear:e[3]||(e[3]=t=>o.listarTodos())},{append:i(()=>[l(s,{name:'search',class:'cursor-pointer',onClick:e[0]||(e[0]=t=>o.listarTodos(!0))})]),_:1},8,['modelValue'])),l(r),l(d,{color:'primary','icon-right':'add',onClick:o.novoContato},{default:i(()=>[q(' Novo contato ')]),_:1},8,['onClick'])]),'body-cell-nome':i(t=>[l(n,{props:t},{default:i(()=>[y('div',null,[(x(),h(m,{id:t.row.pessoa.id,key:t.row.pessoa.id},null,8,['id'])),q(' '+g(t.row.pessoa.nome)+' ',1),t.row.favorito?(x(),h(s,{key:0,name:'star',color:'yellow',size:'sm'})):S('',!0)])]),_:2},1032,['props'])]),'body-cell-tipoContato':i(t=>[l(n,{props:t},{default:i(()=>[o.isMobile?(x(),N('span',Xo,'Forma de contato:')):S('',!0),q(' '+g(t.row.tipoContato),1)]),_:2},1032,['props'])]),'body-cell-actions':i(t=>[l(n,{props:t},{default:i(()=>[l(V,{row:t.row,options:o.extraActions,onEditar:o.editarContato,onExcluir:o.excluirContato},{'item-favorite':i(()=>[$((x(),h(w,{clickable:'',class:'row',onClick:A=>o.toggleFavorito(t.row)},{default:i(()=>[l(b,null,{default:i(()=>[q(g(t.row.favorito?'Desfavoritar':'Favoritar'),1)]),_:2},1024),l(b,{avatar:''},{default:i(()=>[l(s,{name:'star'})]),_:1})]),_:2},1032,['onClick'])),[[_]])]),_:2},1032,['row','options','onEditar','onExcluir'])]),_:2},1032,['props'])]),'body-cell-endereco':i(t=>[l(n,{props:t},{default:i(()=>[y('div',null,g(t.row.pessoa.endereco.bairro)+', '+g(t.row.pessoa.endereco.cidade)+' - '+g(t.row.pessoa.endereco.estado),1)]),_:2},1032,['props'])]),_:1},8,['rows','columns','loading']),l(z,{modelValue:o.showDialog,'onUpdate:modelValue':e[5]||(e[5]=t=>o.showDialog=t),contato:o.contatoSelecionado,onAtualizar:o.listarTodos},null,8,['modelValue','contato','onAtualizar'])])}const re=U(Jo,[['render',Yo],['__scopeId','data-v-d8c9b922']]);export{re as default}
